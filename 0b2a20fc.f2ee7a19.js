(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{133:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return l})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return p}));var a=t(1),i=t(9),r=(t(0),t(181)),o={id:"environment_variables",title:"Environment variables"},l={id:"environment_variables",title:"Environment variables",description:"There are two ways of passing in environment variables to your applications/tests:",source:"@site/docs/environment_variables.md",permalink:"/docs/environment_variables",editUrl:"https://github.com/CantaraJS/cantara/edit/master/docs/docs/environment_variables.md",sidebar:"main",previous:{title:"Testing with Jest",permalink:"/docs/testing_with_jest"},next:{title:"Building packages/apps",permalink:"/docs/building_packages_apps"}},c=[{value:"Adding a new environment variable",id:"adding-a-new-environment-variable",children:[]},{value:"Using .env files",id:"using-env-files",children:[{value:"Project wide .env files",id:"project-wide-env-files",children:[]}]},{value:"Defining environment variables manually",id:"defining-environment-variables-manually",children:[]},{value:"The --stage parameter",id:"the---stage-parameter",children:[]},{value:"Optional Environment Variables",id:"optional-environment-variables",children:[]},{value:"Setting Evironment Variables Directly in Configuration",id:"setting-evironment-variables-directly-in-configuration",children:[]}],s={rightToc:c};function p(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"There are two ways of passing in environment variables to your applications/tests:\nEither throug the actual environment variables of the system Cantara is running on or through ",Object(r.b)("inlineCode",{parentName:"p"},".env")," files."),Object(r.b)("p",null,"Passing in environment variables through directly from the system is usally used in CI environments, whereas the use case of ",Object(r.b)("inlineCode",{parentName:"p"},".env")," files is primarily in development environments, but that depends on your workflow."),Object(r.b)("h2",{id:"adding-a-new-environment-variable"},"Adding a new environment variable"),Object(r.b)("p",null,"The first step when adding a new environment variable is adding a new entry in the ",Object(r.b)("inlineCode",{parentName:"p"},"env")," array of the app's ",Object(r.b)("inlineCode",{parentName:"p"},"cantara.config.js"),". Go to the ",Object(r.b)("inlineCode",{parentName:"p"},"cantara.config.js")," file of the app/package where the environment variable is needed. If there is no ",Object(r.b)("inlineCode",{parentName:"p"},"cantara.config.js"),", create a new one. It could look like that:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"module.exports = {\n  env: ['MY_ENV_VAR'],\n};\n")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"Usually")," when adding environment variables to packages it's just because they are needed during tests."),Object(r.b)("p",null,"By adding ",Object(r.b)("inlineCode",{parentName:"p"},"MY_ENV_VAR")," to this array, Cantara now knows that ",Object(r.b)("inlineCode",{parentName:"p"},"MY_ENV_VAR")," must be defined during execution and can warn the developer if that's not the case."),Object(r.b)("h2",{id:"using-env-files"},"Using .env files"),Object(r.b)("p",null,"Now, in the application folder create a new file called ",Object(r.b)("inlineCode",{parentName:"p"},".env.development")," and add the folllowing content:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"MY_ENV_VAR=env_var_value123\n")),Object(r.b)("p",null,"When you now start the development of your app using the ",Object(r.b)("inlineCode",{parentName:"p"},"dev")," command, the value of ",Object(r.b)("inlineCode",{parentName:"p"},"process.env.MY_ENV_VAR")," will be ",Object(r.b)("inlineCode",{parentName:"p"},"env_var_value123"),". When executing the ",Object(r.b)("inlineCode",{parentName:"p"},"test")," or ",Object(r.b)("inlineCode",{parentName:"p"},"e2e")," command, Cantara will look if there is a file called ",Object(r.b)("inlineCode",{parentName:"p"},".env.test")," in the app's folder. If not, it will fall back to ",Object(r.b)("inlineCode",{parentName:"p"},".env"),". For building/deploying, Cantara will look for a file called ",Object(r.b)("inlineCode",{parentName:"p"},".env.production"),"."),Object(r.b)("h3",{id:"project-wide-env-files"},"Project wide .env files"),Object(r.b)("p",null,"If some env var values are needed in multiple applications, e.g. in two NodeJS APIs, you can create a ",Object(r.b)("inlineCode",{parentName:"p"},".env.<stage>")," file in the project's root. This way, you don't need to define the env variable value twice."),Object(r.b)("h2",{id:"defining-environment-variables-manually"},"Defining environment variables manually"),Object(r.b)("p",null,"Instead of creating those files, you can also define the environment variabled yourself by setting them in the current environment, e.g. your CI server. ",Object(r.b)("strong",{parentName:"p"},"You need to prefix them"),", for example: If your CI system wants to run the ",Object(r.b)("inlineCode",{parentName:"p"},"build")," command for one of your apps and there's a environment variable called ",Object(r.b)("inlineCode",{parentName:"p"},"MY_ENV_VAR")," required, define it by prefixing it with ",Object(r.b)("inlineCode",{parentName:"p"},"PRODUCTION_"),", this ",Object(r.b)("inlineCode",{parentName:"p"},"PRODUCTION_MY_ENV_VAR"),". This can also be done for the testing environment by setting ",Object(r.b)("inlineCode",{parentName:"p"},"TEST_MY_ENV_VAR"),"."),Object(r.b)("h2",{id:"the---stage-parameter"},"The --stage parameter"),Object(r.b)("p",null,"By appending the ",Object(r.b)("inlineCode",{parentName:"p"},"--stage")," parameter to any Cantara command, you can explicitly define which ",Object(r.b)("inlineCode",{parentName:"p"},".env")," file or which environment variables from the system should be used. For example if you execute ",Object(r.b)("inlineCode",{parentName:"p"},"ctra dev my-app --stage production")," the ",Object(r.b)("inlineCode",{parentName:"p"},".env.production")," file will be used. You can also create custom stages, e.g. ",Object(r.b)("inlineCode",{parentName:"p"},".env.staging")," and execute commands using those stages, e.g. ",Object(r.b)("inlineCode",{parentName:"p"},"ctra build --stage staging"),". This can be useful if you have other environments then just your local development environemnt and the production environment, e.g. a staging server."),Object(r.b)("h2",{id:"optional-environment-variables"},"Optional Environment Variables"),Object(r.b)("p",null,"By default cantara replaces all environment variables, specified in the ",Object(r.b)("inlineCode",{parentName:"p"},"cantara.config.js"),", with there value on build time. While this is a desierable behavior for frontend code, in nodejs applications running on a server, it may be expected to read environment varialbes on runtime direclty form the server environment."),Object(r.b)("p",null,"To aceive this it is possible to mark environment varialbes as optional:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"module.exports = {\n  env: [{ var: 'MY_ENV_VAR', optional: true }],\n};\n")),Object(r.b)("p",null,"This way cantara will replace the environment variable if it is defined on build (i.e. during development), but will leave it as is, if it is not defined (i.e. for production)."),Object(r.b)("h2",{id:"setting-evironment-variables-directly-in-configuration"},"Setting Evironment Variables Directly in Configuration"),Object(r.b)("p",null,"In some rare use cases it might not be possible to define environment varialbes in the .env files, but the values must be computed at build time. In this cases the value can be directly injected in the ",Object(r.b)("inlineCode",{parentName:"p"},"cantara.config.js"),". A common use case for this is the injection of the version from the ",Object(r.b)("inlineCode",{parentName:"p"},"package.json")," :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"const pkg = require('./package.json');\nmodule.exports = {\n  env: [{ var: 'VERSION', value: pkg.version }],\n};\n")))}p.isMDXComponent=!0},181:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var a=t(0),i=t.n(a);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=i.a.createContext({}),p=function(e){var n=i.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l({},n,{},e)),t},b=function(e){var n=p(e.components);return i.a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},u=Object(a.forwardRef)((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=p(t),u=a,m=b["".concat(o,".").concat(u)]||b[u]||d[u]||r;return t?i.a.createElement(m,l({ref:n},s,{components:t})):i.a.createElement(m,l({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,o=new Array(r);o[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);